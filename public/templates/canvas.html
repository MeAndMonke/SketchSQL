<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/canvas.css">
    <title>Draw SQL</title>
</head>
<body>
    <div class="flex-column container">

        <div class="topBar">
            <button id="exportSQL">Export as SQL</button>
        </div>

        <div class="flex-row container">
            <div class="sidebar">
            </div>
            <div class="mainScreen">
                <button id="addNode">+</button>
                <div id="canvas"></div>
            </div>
        </div>

    </div>
</body>

<script type="module">
    import { NodeManager } from "../scripts/models/nodeManager.js";
    import { Sidebar } from "../scripts/ui//sidebar/Sidebar.js";
    import { Canvas } from "../scripts/core/canvas.js";
    import { colorPalette } from "../scripts/config/colors.js";
    import { typeOptions } from "../scripts/config/types.js";
    import { generateSQL, downloadSQL } from "../scripts/utils/sqlExport.js";
    const sidebarElement = document.querySelector('.sidebar');

    const nodeManager = new NodeManager();
    
    const sidebar = new Sidebar({ sidebarElement, nodeManager, typeOptions, colorPalette });

    const addNodeBtn = document.querySelector('#addNode');
    if (addNodeBtn) {
        addNodeBtn.addEventListener('click', () => {
            const nodes = nodeManager.getNodes();
            const newId = Math.max(0, ...nodes.map(n => n.id || 0)) + 1;
            nodeManager.addNode({ id: newId, name: `Node${newId}`, rows: [] });
            sidebar.render();
        });
    }

    const canvasElement = document.getElementById('canvas');
    const canvas = new Canvas(canvasElement, nodeManager);

    sidebar.render();
    canvas.syncWithNodeManager();
    
    // Export SQL functionality
    const exportSQLBtn = document.querySelector('#exportSQL');
    if (exportSQLBtn) {
        exportSQLBtn.addEventListener('click', () => {
            const sql = generateSQL(nodeManager.getNodes());
            downloadSQL(sql);
        });
    }
</script>

</html>